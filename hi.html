<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thi·ªáp 20/10 ‚Äî Phi√™n b·∫£n Cao C·∫•p</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark:#120b18;--bg-deep:#24132a;--gold:#ffd67a;--accent:#b38bff;--muted:rgba(255,255,255,0.85);
  --success:#6ae29a; --error:#ff7b9c;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
  font-family:"Inter",system-ui; background:
  radial-gradient(circle at 10% 20%,rgba(179,139,255,0.07),transparent 10%),
  radial-gradient(circle at 90% 80%,rgba(255,214,122,0.05),transparent 10%),
  linear-gradient(180deg,var(--bg-deep),var(--bg-dark));
  color:var(--muted);
}
.card{width:92%;max-width:720px;background:rgba(255,255,255,0.03);border-radius:20px;
  padding:28px;box-shadow:0 20px 60px rgba(10,6,12,0.6);border:1px solid rgba(255,215,130,0.06);
  display:grid;grid-template-columns:1fr 340px;gap:20px;position:relative;z-index:10;}
.left{padding:10px 18px;}
.logo{
  font-family:"Playfair Display",serif;
  font-size:32px;
  color:var(--gold);
  text-align:center;
  margin-bottom:8px;
  text-shadow:0 0 12px rgba(255,215,130,0.3);
}
h1{
  margin:6px 0 10px;
  font-family:"Playfair Display",serif;
  color:var(--gold);
  font-size:28px;
  text-align:center;
}
.subtitle{color:rgba(255,255,255,0.85);line-height:1.45;font-size:15px;margin-bottom:16px;text-align:center;}
.panel{background:rgba(255,255,255,0.02);border-radius:14px;padding:18px;text-align:center;}
input[type="text"]{
  width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.02);color:var(--muted);font-size:15px;margin-bottom:12px;text-align:center;
}
.btn{
  display:inline-block;padding:10px 20px;border-radius:999px;border:none;
  background:linear-gradient(90deg,var(--accent),var(--gold));color:#22121a;font-weight:700;cursor:pointer;font-size:15px;
}
.btn:hover{transform:translateY(-4px);box-shadow:0 20px 40px rgba(179,139,255,0.15);}
.giftMsg{
  margin-top:14px;min-height:48px;font-weight:600;color:var(--gold);font-size:16px;opacity:0;
  transition:opacity .4s;
}
.giftMsg.show{opacity:1;animation:pop .9s cubic-bezier(.22,.9,.32,1);}
@keyframes pop{0%{transform:scale(.92);opacity:0}60%{transform:scale(1.04);opacity:1}100%{transform:scale(1)}}
.credit{position:absolute;bottom:12px;left:18px;font-size:12px;color:rgba(255,255,255,0.35);}

/* overlay (darken) */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(6px);z-index:1000;display:none;}
.overlay.show{display:block;}

/* quiz popup */
.popup{
  position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.96);
  background:rgba(25,15,35,0.96);border-radius:18px;padding:26px 28px;z-index:1100;min-width:360px;
  border:1px solid rgba(255,215,130,0.35);box-shadow:0 10px 40px rgba(0,0,0,0.6);color:#fff;display:none;
}
.popup.show{display:block;animation:popupIn .24s ease;}
@keyframes popupIn{from{opacity:0;transform:translate(-50%,-50%) scale(.94)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
.popup h2{font-family:"Playfair Display",serif;color:var(--gold);font-size:20px;text-align:center;margin:0 0 8px;}
.question{text-align:center;font-size:15px;margin-bottom:12px;color:rgba(255,255,255,0.92);}
.quiz-options{display:flex;flex-direction:column;gap:10px;margin-top:6px;}
.option{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.06);}
.option:hover{background:rgba(255,255,255,0.08);}
.option input{appearance:none;width:18px;height:18px;border-radius:50%;border:2px solid var(--gold);position:relative;}
.option input:checked::after{content:"";position:absolute;inset:3px;background:var(--gold);border-radius:50%;}
.option span{flex:1;color:#fff;font-size:14px;}
#otherAnswer{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:#fff;font-size:14px;margin-top:10px;}
.closeX{position:absolute;right:12px;top:10px;color:rgba(255,255,255,0.7);cursor:pointer;font-size:18px;}

/* message popups (appear on top of everything) */
.messagePopup{
  position:fixed;
  left:50%;
  top:18%;
  transform:translateX(-50%) translateY(-10px) scale(.98);
  min-width:260px;
  max-width:90vw;
  padding:14px 18px;
  border-radius:12px;
  color:#111;
  font-weight:700;
  text-align:center;
  z-index:2000; /* VERY HIGH so it's above the card */
  display:none;
  box-shadow:0 12px 40px rgba(0,0,0,0.45);
  backdrop-filter: blur(6px);
}
.messagePopup.show{display:block;animation:msgIn .22s cubic-bezier(.2,.9,.3,1) forwards;}
@keyframes msgIn{from{opacity:0;transform:translateX(-50%) translateY(-20px) scale(.96)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}

/* success style */
.msg-success{background:linear-gradient(90deg, rgba(106,226,154,0.12), rgba(106,226,154,0.06));border:1px solid rgba(106,226,154,0.28);color:var(--success);}

/* error style */
.msg-error{background:linear-gradient(90deg, rgba(255,123,156,0.08), rgba(255,123,156,0.04));border:1px solid rgba(255,123,156,0.22);color:var(--error);}

/* small fade helper */
.fadeOut{opacity:0;transition:opacity 0.9s ease;}
</style>
</head>
<body>

<!-- overlay for modal -->
<div id="overlay" class="overlay" aria-hidden="true"></div>

<!-- main card -->
<div class="card" role="main" aria-labelledby="title">
  <div class="left">
    <div class="logo">Ch√∫c c·∫≠u 20/10 vui v·∫ª n√®!!!</div>
    <div class="subtitle">Nh√¢n ng√†y 20/10, ch√∫c c·∫≠u th·∫≠t nh√¨u ni·ªÅm vui, s·ª©c kh·ªèe, h·∫°nh ph√∫c b√™n ng∆∞·ªùi m√¨nh iu th∆∞∆°ng <33 </div>
  </div>

  <div class="panel" aria-label="Form nh·∫≠n qu√†">
    <input id="nameInput" type="text" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." aria-label="T√™n ng∆∞·ªùi nh·∫≠n">
    <div style="display:flex; gap:10px; justify-content:center; margin-top:6px;">
      <button class="btn" id="btnGift" aria-label="Nh·∫≠n qu√†">Nh·∫≠n qu√†</button>
      <button class="btn" id="btnRetry" aria-label="Nh·∫≠n l·∫°i" style="background:transparent;border:1px solid rgba(255,255,255,0.15);color:var(--muted)">Nh·∫≠n l·∫°i</button>
    </div>
    <div class="giftMsg" id="giftMsg" aria-live="polite"></div>
  </div>

  <div class="credit">‚Äî From duahauus</div>
</div>

<!-- quiz popup -->
<div class="popup" id="quizPopup" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="closeX" id="closeQuiz" title="ƒê√≥ng">‚úï</div>
  <h2>‚ú® Tr·∫Øc nghi·ªám nh·∫≠n l·∫°i qu√† ‚ú®</h2>
  <div class="question">C√¢u h·ªèi: <strong>D∆∞a h·∫•u th√≠ch g√¨?</strong></div>
  <div class="quiz-options" id="quizOptions">
    <label class="option"><input type="radio" name="qOpt" value="A"><span>A. Th√≠ch D∆∞a H·∫•u</span></label>
    <label class="option"><input type="radio" name="qOpt" value="B"><span>B. Th√≠ch Thanh H√†</span></label>
    <label class="option"><input type="radio" name="qOpt" value="C"><span>C. Th√≠ch Huce</span></label>
    <label class="option"><input type="radio" name="qOpt" value="D"><span>D. Th√≠ch Miyu</span></label>
    <label class="option"><input type="radio" name="qOpt" value="E"><span>E. ƒê√°p √°n kh√°c</span></label>
  </div>
  <div id="otherAnswerWrap" style="display:none;">
    <input id="otherAnswer" type="text" placeholder="Nh·∫≠p ƒë√°p √°n kh√°c...">
  </div>
  <div style="text-align:right;margin-top:14px;">
    <button class="btn" id="submitQuiz">N·ªôp ƒë√°p √°n</button>
  </div>
</div>

<!-- floating message popups (appear above everything) -->
<div id="msgSuccess" class="messagePopup msg-success" role="status" aria-live="polite"></div>
<div id="msgError" class="messagePopup msg-error" role="status" aria-live="polite"></div>

<audio id="ding" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2023/03/28/audio_09d3726a7d.mp3?filename=ding-126626.mp3" type="audio/mpeg">
</audio>

<script>
/* CONFIG (replace with your Apps Script if you log) */
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz6eC6nbVIrae32eYQAiogvdJEsTK0gO4F_hqX8Brguv55mZ2bGtCZz24nBzbCnPrk/exec";

/* ELEMENTS */
const btnGift = document.getElementById('btnGift');
const btnRetry = document.getElementById('btnRetry');
const nameInput = document.getElementById('nameInput');
const giftMsg = document.getElementById('giftMsg');
const ding = document.getElementById('ding');
const quizPopup = document.getElementById('quizPopup');
const overlay = document.getElementById('overlay');
const closeQuiz = document.getElementById('closeQuiz');
const quizOptions = document.getElementById('quizOptions');
const otherAnswerWrap = document.getElementById('otherAnswerWrap');
const otherAnswer = document.getElementById('otherAnswer');
const submitQuiz = document.getElementById('submitQuiz');
const msgSuccess = document.getElementById('msgSuccess');
const msgError = document.getElementById('msgError');

let hideTimeout = null;

/* helper: device id + used key */
function getDeviceId(){
  const key='__thiep_device_v4';
  let id = localStorage.getItem(key);
  if(!id){
    const raw = navigator.userAgent + '|' + navigator.language + '|' + screen.width + 'x' + screen.height + '|' + window.devicePixelRatio;
    try { id = btoa(unescape(encodeURIComponent(raw))).substring(0,20); }
    catch(e){ id = Math.random().toString(36).slice(2,14); }
    localStorage.setItem(key, id);
  }
  return id;
}
const deviceId = getDeviceId();
const usedKey = 'thiep_used_' + deviceId;

/* random gifts */
function makeRandomGift(){
  const choices = [
    "M·ªôt l·ªùi ch√∫c ng·ªß ngon l√∫c 23:59 ph√∫t ng√†y 20/10 üåô",
    "Kh√≥ l√≥i",
    "Thoii, h·∫πn nƒÉm sau m√¨nh ch∆°i l·∫°i nh√© hehe",
    "M·ªôt l·ªùi ch√∫c th·∫≠t l√≤ng, kh√¥ng gi·∫£ d·ªëi :>",
    "M·ªôt ng√†y l√™n l√†m ch·ªß clan :> ƒë·∫•y l√† tui n√≥i th·∫ø ch·ª© b·∫°n ƒë√≥ kh√¥ng ch·ªãu th√¨ c≈©ng ph·∫£i ch·ªãu",
    `${Math.floor(Math.random()*10)+1} b√¥ng hoa üå∑`,
    `${Math.floor(Math.random()*5)+1} ch√πm b√¥ng üíê`
  ];
  return choices[Math.floor(Math.random()*choices.length)];
}

/* show transient message on top (success or error) */
function showTopMessage(el, text, ms=2200){
  el.textContent = text;
  el.style.display = 'block';
  el.classList.add('show');
  setTimeout(()=> {
    el.classList.remove('show');
    setTimeout(()=> el.style.display = 'none', 260);
  }, ms);
}

/* show "already received" message inline */
function showAlreadyReceivedInline(name=''){
  giftMsg.textContent = `B·ªè c√°i tay ra ${name ? name + ', ' : ''}ƒë√£ nh·∫≠n qu√† r·ªìi m√† c√≤n b·∫•m n·ªØa z :> `;
  giftMsg.classList.add('show');
  if(hideTimeout) clearTimeout(hideTimeout);
  hideTimeout = setTimeout(()=>{
    giftMsg.classList.add('fadeOut');
    setTimeout(()=>{
      giftMsg.classList.remove('show','fadeOut');
      giftMsg.textContent = '';
    }, 900);
  }, 5000);
}

/* click "Nh·∫≠n qu√†" */
btnGift.addEventListener('click', ()=>{
  const name = (nameInput.value || '').trim();

  // N·∫øu ch∆∞a nh·∫≠p t√™n -> ch·ªâ hi·ªán th√¥ng b√°o, kh√¥ng nh·∫≠n qu√†
  if(!name){
    showTopMessage(msgError, "T√™n ƒë√¢u m√† ƒë√≤i nh·∫≠n qu√† z", 2500);
    nameInput.focus();
    return;
  }

  // N·∫øu ƒë√£ nh·∫≠n r·ªìi
  if(localStorage.getItem(usedKey)){
    showAlreadyReceivedInline(name);
    return;
  }

  // T·∫°o qu√† v√† hi·ªÉn th·ªã
  const gift = makeRandomGift();
  giftMsg.textContent = `üíñ ${name}, b·∫°n nh·∫≠n ƒë∆∞·ª£c: ${gift}`;
  giftMsg.classList.add('show');
  ding.currentTime = 0;
  ding.play().catch(()=>{});
  localStorage.setItem(usedKey, JSON.stringify({name, gift, ts: Date.now()}));

  // G·ª≠i log (kh√¥ng ch·∫∑n)
  try {
    fetch(SHEET_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({name, gift, deviceId, answer: ""})
    });
  } catch(e){}
});

/* "Nh·∫≠n l·∫°i" m·ªü quiz */
btnRetry.addEventListener('click', ()=>{
  if(!localStorage.getItem(usedKey)){
    showTopMessage(msgError, "B·∫°n ch∆∞a nh·∫≠n qu√† l·∫ßn ƒë·∫ßu ‚Äî h√£y b·∫•m 'Nh·∫≠n qu√†' tr∆∞·ªõc nh√©.", 2400);
    return;
  }
  overlay.classList.add('show');
  quizPopup.classList.add('show');
});

/* ƒë√≥ng quiz */
closeQuiz.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  quizPopup.classList.remove('show');
  document.querySelectorAll('input[name="qOpt"]').forEach(i => i.checked = false);
  otherAnswer.value = '';
  otherAnswerWrap.style.display = 'none';
});

/* hi·ªán √¥ nh·∫≠p n·∫øu ch·ªçn E */
quizOptions.addEventListener('change', ()=>{
  const v = document.querySelector('input[name="qOpt"]:checked')?.value;
  otherAnswerWrap.style.display = v === 'E' ? 'block' : 'none';
});

/* n·ªôp ƒë√°p √°n */
submitQuiz.addEventListener('click', ()=>{
  const selected = document.querySelector('input[name="qOpt"]:checked');
  if(!selected){
    showTopMessage(msgError, 'Vui l√≤ng ch·ªçn ƒë√°p √°n.', 2000);
    return;
  }
  const val = selected.value;
  const other = (otherAnswer.value || '').trim();
  if(val === 'E' && other.length === 0){
    showTopMessage(msgError, 'Nh·∫≠p ƒë√°p √°n cho E nha!', 2000);
    return;
  }

  const name = (nameInput.value || '').trim() || '·∫®n danh';
  const answerText = val === 'E' ? other : val;

  try {
    fetch(SHEET_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({name, gift: "(ƒê√£ c√≥ qu√†)", deviceId, answer: answerText})
    });
  } catch(e){}

  const correct = val === 'E' && /^clan$/i.test(other.trim());
  if(correct){
    localStorage.removeItem(usedKey);
    showTopMessage(msgSuccess, "Bingo! Qu√†o qu√†o gi·ªèi qu√°, kh√¥ng ng·ªù lu√¥n nha, cho nh·∫≠n l·∫°i qu√† ƒë√≥ :>", 3000);
  } else {
    const msgs = [
      "Lew lew, clan gaf qu√°, d·ªÖ th·∫ø m√† c≈©ng sai r·ªìi!",
      "Hehehe, tr·∫≠t l·∫•t",
      "Kh√¥ng tr√∫ng lu√¥n",
      "Tr√∫ng r·ªìi n√®, c∆° m√† l√† tr√∫ng tim t·ªõ m·∫•t r√πi",
      "ƒêo√°n th√™m 10 l·∫ßn n·ªØa c≈©ng sai thoii",
      "ƒêi ng·ªß ƒëi!",
      "Kh√≥ l·∫Øm ƒë√¢u ta m√† l√†m sai z"
    ];
    showTopMessage(msgError, msgs[Math.floor(Math.random()*msgs.length)], 3000);
  }
  overlay.classList.remove('show');
  quizPopup.classList.remove('show');
  document.querySelectorAll('input[name="qOpt"]').forEach(i => i.checked = false);
  otherAnswer.value = '';
  otherAnswerWrap.style.display = 'none';
});

/* admin reset (Ctrl+R) */
document.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.key.toLowerCase() === 'r'){
    localStorage.removeItem(usedKey);
    showTopMessage(msgSuccess, 'üîÅ ƒê√£ xo√° tr·∫°ng th√°i test ‚Äî c√≥ th·ªÉ nh·∫≠n l·∫°i.', 3000);
    giftMsg.classList.remove('show');
    giftMsg.textContent = '';
  }
});
</script>

</body>
</html>
